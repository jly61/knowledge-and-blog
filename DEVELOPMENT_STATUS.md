# 开发状态

## ✅ 已完成功能

### AI 功能（新增）✅
- ✅ v1.0 对话侧边栏
  - ✅ 自定义 useChat Hook（lib/ai/use-chat.ts）
  - ✅ 聊天侧边栏组件（components/ai/chat-sidebar.tsx）
  - ✅ 消息显示组件（components/ai/chat-message.tsx）
  - ✅ 聊天 API 路由（app/api/ai/chat/route.ts）
  - ✅ 支持 OpenAI API（优先使用）
  - ✅ 支持 Ollama 本地模型（免费方案）
  - ✅ 流式响应处理（打字机效果）
  - ✅ SSE 格式数据流转换
  - ✅ Markdown 渲染支持（代码块、表格等）
  - ✅ 中文输入法支持（输入时回车不发送）
  - ✅ 错误处理和加载状态
  - ✅ 请求取消机制（AbortController）
  - ✅ 自动滚动到底部
  - ✅ Ollama 客户端配置（延迟初始化，避免启动失败）
  - ✅ 健康检查（API 调用前检查服务可用性）
  - ✅ AI 客户端配置（lib/ai/client.ts）
  - ✅ Prompt 模板（lib/ai/prompts.ts）
  - ✅ 文档支持
    - ✅ AI 功能开发规划（docs/AI_FEATURES_PLAN.md）
    - ✅ AI 功能快速开始（docs/AI_QUICK_START.md）
    - ✅ AI 功能教学文档（docs/AI_FEATURES_TUTORIAL.md）
    - ✅ Ollama 设置指南（docs/OLLAMA_SETUP.md）
- [ ] v2.0 知识库问答（RAG）
  - [ ] 向量数据库集成（pgvector）
  - [ ] 笔记向量化功能
  - [ ] 向量检索功能
  - [ ] 上下文注入
- [ ] AI 自动生成摘要和 SEO
- [ ] AI 自动标签推荐
- [ ] AI 双向链接建议
- [ ] v4.0 思维导图生成
- [ ] v3.0 编辑器副驾驶

### 面试题库功能（新增）✅
- ✅ 文件系统读取：自动解析 `interview/` 文件夹结构
- ✅ 树形导航：左侧多级目录导航，支持展开/收起
- ✅ 文章目录：右侧自动提取 Markdown 标题生成目录，支持锚点跳转
- ✅ 排序功能：支持通过文件名前缀（如 `01-xxx`）进行排序
  - 都有排序号：按数字大小排序
  - 一个有排序号：有排序号的优先
  - 都没有排序号：保持文件系统读取顺序
- ✅ 热更新：每次请求重新读取文件系统，支持实时更新
- ✅ 路径解码：正确处理 URL 编码的中文字符
- ✅ 状态管理：使用模块级变量持久化菜单展开状态
- ✅ 导航菜单：在首页、博客、知识库页面添加面试菜单链接
- ✅ 首页菜单：在博客和知识库页面添加首页菜单链接

### 第一阶段：基础搭建 ✅

#### 1. 认证系统
- ✅ NextAuth.js 配置（支持 GitHub/Google OAuth）
- ✅ 登录页面
- ✅ 中间件路由保护
- ✅ 服务端认证工具函数

#### 2. 基础布局
- ✅ 根布局（app/layout.tsx）
- ✅ 仪表板布局（app/(dashboard)/layout.tsx）
- ✅ 博客布局（app/(blog)/layout.tsx）
- ✅ 首页（app/page.tsx）

#### 3. UI 组件
- ✅ Button, Input, Card, Textarea, Label
- ✅ Select, Checkbox, Popover, Dialog, AlertDialog, Tabs
- ✅ 全局样式（Tailwind CSS）
- ✅ Toast 通知（sonner）

#### 4. 笔记管理（基础）
- ✅ 笔记列表页面
- ✅ 笔记详情页面
- ✅ 新建笔记页面
- ✅ 编辑笔记页面
- ✅ 笔记 Server Actions（创建、更新、删除）
- ✅ 笔记卡片组件
- ✅ 笔记编辑器组件
- ✅ 笔记查看组件
- ✅ 反向链接面板

#### 5. 博客功能（基础）
- ✅ 博客首页（文章列表）
- ✅ 基础布局

## 🚧 进行中

### 第二阶段：知识库核心功能

#### 1. 双向链接系统
- ✅ 链接自动解析和创建
- ✅ 链接实时渲染（将 [[笔记标题]] 转换为可点击链接）
- ✅ 断链检测和显示
- ✅ 链接预览功能（悬停显示笔记摘要、分类、标签等信息）
- [ ] 链接建议（输入时显示）

#### 2. Markdown 编辑器增强 ✅
- ✅ 分屏编辑器（左侧 Markdown 编辑，右侧实时预览）
- ✅ 同步滚动（编辑和预览区域同步滚动）
- ✅ 语法高亮（代码块语法高亮，使用 highlight.js）
- ✅ 图片上传支持（集成图片上传功能）
- ✅ 双向链接支持（支持 `[[笔记标题]]` 语法）

#### 3. 搜索功能
- ✅ 笔记搜索 API（支持标题、内容、标签、分类搜索）
- ✅ 搜索页面
- ✅ 高级搜索（标签、分类筛选）
- ✅ 搜索高亮
- [ ] 日期范围筛选
- [ ] 搜索历史

#### 4. 分类和标签管理
- ✅ 分类管理页面（创建、编辑、删除）
- ✅ 标签管理页面（创建、编辑、删除）
- ✅ 分类和标签统计（显示笔记和文章数量）
- ✅ 颜色标识支持
- [ ] 批量操作（批量添加/删除标签、批量移动分类）

### 第三阶段：知识图谱 ✅

- ✅ 图谱数据 API（app/actions/graph.ts）
- ✅ 图谱可视化组件（vis-network）
- ✅ 节点交互（点击跳转、悬停提示）
- ✅ 图谱筛选（按标签、分类）
- ✅ 图谱控制工具（缩放、自适应、刷新）
- [ ] 图谱导出（图片导出）

### 第四阶段：博客功能

- ✅ 文章详情页
- ✅ 笔记转文章功能
- ✅ 文章编辑
- ✅ SEO 优化（元数据、sitemap、robots.txt、结构化数据）
- ✅ 文章分类和标签页面
- ✅ 评论系统
  - ✅ 发表评论（支持匿名和登录用户）
  - ✅ 回复评论（支持嵌套回复）
  - ✅ 删除评论（评论作者或文章作者可删除）
  - ✅ 评论列表展示
  - ✅ 用户头像显示（登录用户显示头像，匿名用户显示首字母）
  - ✅ 相对时间显示（刚刚、X分钟前等）
- [ ] RSS 订阅

### 第五阶段：高级功能

- ✅ MOC (Map of Contents)
  - ✅ MOC 笔记标记（`isMOC` 字段）
  - ✅ MOC 列表页面
  - ✅ MOC 链接面板（显示 MOC 中链接的笔记）
  - ✅ 笔记编辑器支持 MOC 标记
- [ ] 笔记版本历史
- [ ] 数据导入/导出
- [ ] 笔记模板

### 第六阶段：优化和部署

- [ ] 性能优化
- [ ] 错误处理
- ✅ 加载状态
  - ✅ 通用加载组件（Skeleton、Spinner）
  - ✅ 页面级加载状态（loading.tsx）
    - ✅ 笔记列表页加载状态
    - ✅ 笔记详情页加载状态
    - ✅ 博客列表页加载状态
    - ✅ 博客详情页加载状态
    - ✅ 搜索页面加载状态
    - ✅ 分类管理页加载状态
    - ✅ 标签管理页加载状态
    - ✅ 知识图谱页加载状态
    - ✅ MOC 页面加载状态
    - ✅ 面试题库页加载状态
  - ✅ 专用骨架屏组件
    - ✅ NoteListSkeleton（笔记列表骨架屏）
    - ✅ PostListSkeleton（博客列表骨架屏）
    - ✅ NoteDetailSkeleton（笔记详情骨架屏）
    - ✅ InterviewContentSkeleton（面试内容骨架屏）
  - ✅ 表单提交加载状态
    - ✅ 笔记编辑器（保存时显示 Spinner）
    - ✅ 文章编辑器（保存时显示 Spinner）
    - ✅ 发布文章（发布时显示 Spinner）
    - ✅ 评论表单（提交时显示 Spinner）
    - ✅ 删除按钮（删除时显示 Spinner 和文本提示）
  - ✅ 面试页面优化（左侧菜单保持稳定，仅右侧内容显示加载状态）
- [ ] 响应式设计优化
- [ ] 测试
- ✅ 部署配置（基础）
  - ✅ Vercel 部署配置
  - ✅ 环境变量配置（基础）
  - ✅ 数据库迁移配置
- ✅ 部署配置（高级）
  - ✅ 生产环境环境变量管理
    - ✅ 环境变量验证脚本（scripts/validate-env.ts）
    - ✅ 环境变量模板（.env.example）
    - ✅ 环境变量文档（docs/DEPLOYMENT_ENV.md）
  - ✅ CI/CD 自动化构建和部署
    - ✅ GitHub Actions CI 工作流（.github/workflows/ci.yml）
    - ✅ GitHub Actions 预览部署（.github/workflows/deploy-preview.yml）
    - ✅ 自动化测试和构建检查
  - ✅ 多环境配置
    - ✅ 环境配置管理（lib/config.ts）
    - ✅ 环境切换脚本（scripts/switch-env.ts）
    - ✅ 环境隔离支持（development/preview/production）
  - ✅ 部署回滚机制
    - ✅ 回滚脚本（scripts/rollback.sh）
    - ✅ 回滚文档（docs/DEPLOYMENT_ROLLBACK.md）
    - ✅ Vercel 回滚支持
- ✅ 监控告警
  - ✅ 性能监控（Sentry Performance / 自定义性能监控）
  - ✅ 错误追踪（Sentry 集成）
  - ✅ 日志聚合（自定义日志系统，集成 Sentry）
  - ✅ 告警通知（邮件/Webhook 通知）
- [ ] 备份策略
  - [ ] 数据库自动备份（Vercel Postgres 自动备份 / 定时备份脚本）
  - [ ] 文件备份（上传的图片文件备份）
  - [ ] 备份恢复机制（数据恢复流程）
  - [ ] 备份验证（定期验证备份完整性）

## 📝 当前可用的功能

### 用户功能
1. **登录/注册**
   - 使用 GitHub 或 Google OAuth 登录
   - 访问 `/login` 页面

2. **笔记管理**
   - 查看笔记列表：`/notes`
   - 创建新笔记：`/notes/new`
   - 查看笔记详情：`/notes/[id]`
   - 编辑笔记：`/notes/[id]/edit`
   - 支持 Markdown 格式
   - 支持 `[[笔记标题]]` 双向链接语法（会自动创建链接关系）
   - 分屏 Markdown 编辑器（左侧编辑，右侧实时预览，支持同步滚动）
   - 代码语法高亮
   - 图片上传和插入
   - 链接预览（悬停显示笔记摘要）

3. **搜索功能**
   - 搜索笔记：`/search`
   - 支持标题和内容搜索
   - 支持按分类和标签筛选
   - 搜索结果高亮显示

4. **分类和标签管理**
   - 分类管理：`/categories`
   - 标签管理：`/tags`
   - 创建、编辑、删除分类和标签
   - 查看分类和标签的使用统计

5. **知识图谱**
   - 查看知识图谱：`/graph`
   - 可视化笔记关系网络
   - 支持按分类和标签筛选
   - 点击节点跳转到笔记详情

6. **博客功能**
   - 查看博客首页：`/blog`
   - 查看文章详情：`/blog/[slug]`
   - 从笔记发布为文章：`/notes/[id]/publish`
   - 编辑文章：`/posts/[slug]/edit`（仅作者可见）
   - 评论功能：
     - 发表评论（登录用户自动填充信息，匿名用户需填写姓名）
     - 回复评论（支持多级嵌套回复）
     - 删除评论（仅评论作者或文章作者）
     - 查看评论列表（按时间倒序）

7. **AI 对话功能**
   - 在笔记详情页使用 AI 助手：`/notes/[id]`
   - 点击右下角聊天按钮打开侧边栏
   - 支持与 AI 进行对话
   - 流式响应显示（打字机效果）
   - 支持 Markdown 渲染（代码块、表格等）
   - 支持中文输入（输入时回车不发送）
   - 支持 OpenAI API（需配置 OPENAI_API_KEY）
   - 支持 Ollama 本地模型（免费，需安装 Ollama）
   - 自动滚动到最新消息
   - 错误提示和加载状态

8. **面试题库**
   - 查看面试题库：`/interview`
   - 查看面试题详情：`/interview/[...path]`
   - 自动解析 `interview/` 文件夹中的 Markdown 文件
   - 支持多级目录结构
   - 支持文件排序（通过文件名前缀）
   - 自动生成文章目录（提取 Markdown 标题）
   - 支持锚点跳转
   - 菜单展开状态持久化

### 技术特性
- ✅ Server Components 数据获取
- ✅ Server Actions 数据修改
- ✅ 类型安全的数据库访问（Prisma）
- ✅ 响应式设计
- ✅ 暗色模式支持（CSS 变量已配置）

## 🔧 下一步开发建议

### 优先级 1：AI 功能增强
1. ✅ v1.0 对话侧边栏（已完成）
2. v2.0 知识库问答（RAG）
   - 向量数据库集成（pgvector）
   - 笔记向量化和检索
   - 上下文注入和引用来源
3. AI 自动生成摘要和 SEO
4. AI 自动标签推荐
5. AI 双向链接建议

### 优先级 2：博客功能
1. ✅ 实现笔记转文章功能
2. ✅ 完善文章详情页
3. ✅ 实现文章编辑功能
4. ✅ 添加 SEO 优化（元数据、sitemap、robots.txt、结构化数据）
5. ✅ 实现评论系统
6. RSS 订阅

### 优先级 3：高级功能
1. 每日笔记
2. ✅ MOC (Map of Contents)
3. 笔记版本历史
4. v4.0 思维导图生成
5. v3.0 编辑器副驾驶

### 优先级 4：优化和完善
1. ✅ Markdown 编辑器增强（分屏编辑、实时预览、同步滚动、语法高亮）
2. ✅ 图片上传支持
3. ✅ 加载状态（页面级加载、表单提交加载、骨架屏组件）
4. 知识图谱布局稳定性优化
5. 搜索功能增强（日期范围、搜索历史）

## 📚 相关文档

- [项目规划](./PROJECT_PLAN.md)
- [实现指南](./IMPLEMENTATION_GUIDE.md)
- [快速开始](./QUICK_START.md)
- [环境配置](./ENV_SETUP.md)
- [AI 功能开发规划](./docs/AI_FEATURES_PLAN.md)
- [AI 功能快速开始](./docs/AI_QUICK_START.md)
- [AI 功能教学文档](./docs/AI_FEATURES_TUTORIAL.md)
- [Ollama 设置指南](./docs/OLLAMA_SETUP.md)

## 🐛 已知问题

1. 双向链接解析需要目标笔记已存在才能创建链接关系
2. 搜索功能已实现基础版本，日期范围筛选待完善
3. 知识图谱每次切换页面会重新计算布局（物理引擎导致）

## 💡 开发提示

1. **运行开发服务器**：`pnpm dev`
2. **查看数据库**：`pnpm db:studio`
3. **生成 Prisma Client**：`pnpm db:generate`
4. **推送数据库变更**：`pnpm db:push`

## 🎯 完成度

- **第一阶段（基础搭建）**：100% ✅
- **第二阶段（知识库核心）**：85% 🚧
- **第三阶段（知识图谱）**：80% ✅
- **第四阶段（博客功能）**：85% 🚧
- **第五阶段（高级功能）**：30% 🚧
  - ✅ MOC (Map of Contents)
  - ✅ 面试题库功能
  - ✅ AI 功能（v1.0 对话侧边栏）
- **第六阶段（优化部署）**：60% 🚧
  - ✅ 加载状态
  - ✅ 部署配置（基础）
  - ✅ 部署配置（高级）
  - ✅ 监控告警
  - [ ] 备份策略
- **AI 功能阶段**：15% 🚧
  - ✅ v1.0 对话侧边栏（100%）
  - [ ] v2.0 知识库问答（RAG）（0%）
  - [ ] AI 自动生成摘要和 SEO（0%）
  - [ ] AI 自动标签推荐（0%）
  - [ ] AI 双向链接建议（0%）
  - [ ] v4.0 思维导图生成（0%）
  - [ ] v3.0 编辑器副驾驶（0%）

**总体完成度：约 86%**

