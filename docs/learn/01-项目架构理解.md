# é˜¶æ®µ 1-2ï¼šé¡¹ç›®æ¶æ„ç†è§£

## ğŸ“š å­¦ä¹ ç›®æ ‡

ç†è§£é¡¹ç›®çš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ç›®å½•ç»“æ„ã€æ ¸å¿ƒç³»ç»Ÿè®¾è®¡å’Œæ•°æ®æµã€‚

## ğŸ¯ å­¦ä¹ æ¸…å•

- [ ] é¡¹ç›®ç›®å½•ç»“æ„åˆ†æ
- [ ] æŠ€æœ¯æ ˆæ¢³ç†
- [ ] è®¤è¯ç³»ç»Ÿæ¶æ„
- [ ] æ•°æ®å±‚æ¶æ„
- [ ] è·¯ç”±ç³»ç»Ÿè®¾è®¡
- [ ] çŠ¶æ€ç®¡ç†ç­–ç•¥

---

## 1. é¡¹ç›®ç›®å½•ç»“æ„

### ğŸ“ æ ¸å¿ƒç›®å½•

```
BigFE/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/            # è®¤è¯ç›¸å…³è·¯ç”±ç»„
â”‚   â”œâ”€â”€ (blog)/            # åšå®¢è·¯ç”±ç»„
â”‚   â”œâ”€â”€ (dashboard)/       # ä»ªè¡¨æ¿è·¯ç”±ç»„
â”‚   â”œâ”€â”€ interview/         # é¢è¯•é¢˜åº“
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â””â”€â”€ actions/           # Server Actions
â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/               # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ notes/            # ç¬”è®°ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ posts/            # æ–‡ç« ç›¸å…³ç»„ä»¶
â”‚   â””â”€â”€ ...
â”œâ”€â”€ lib/                  # å·¥å…·å‡½æ•°å’Œé…ç½®
â”‚   â”œâ”€â”€ auth.ts          # NextAuth é…ç½®
â”‚   â”œâ”€â”€ db.ts            # Prisma Client
â”‚   â””â”€â”€ utils.ts         # å·¥å…·å‡½æ•°
â”œâ”€â”€ prisma/               # Prisma é…ç½®
â”‚   â””â”€â”€ schema.prisma    # æ•°æ®åº“æ¨¡å‹
â””â”€â”€ public/               # é™æ€èµ„æº
```

### ğŸ¯ é‡ç‚¹ç›®å½•è¯´æ˜

#### app/ ç›®å½•
- **è·¯ç”±ç»„**ï¼š`(auth)`ã€`(blog)`ã€`(dashboard)` - ç”¨äºç»„ç»‡ä»£ç ï¼Œä¸å‡ºç°åœ¨ URL
- **åŠ¨æ€è·¯ç”±**ï¼š`[id]`ã€`[slug]`ã€`[...path]` - å‚æ•°åŒ–è·¯ç”±
- **ç‰¹æ®Šæ–‡ä»¶**ï¼š
  - `layout.tsx` - å¸ƒå±€ç»„ä»¶
  - `page.tsx` - é¡µé¢ç»„ä»¶
  - `loading.tsx` - åŠ è½½çŠ¶æ€
  - `route.ts` - API è·¯ç”±

**å®è·µ**ï¼šåˆ†æè·¯ç”±ç»“æ„
```bash
# æŸ¥çœ‹è·¯ç”±ç»“æ„
find app -name "page.tsx" -o -name "layout.tsx" | head -20
```

#### components/ ç›®å½•
- **ui/** - åŸºç¡€ UI ç»„ä»¶ï¼ˆshadcn/uiï¼‰
- **åŠŸèƒ½ç»„ä»¶** - æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼ˆnotesã€postsã€graph ç­‰ï¼‰

**å®è·µ**ï¼šæŸ¥çœ‹ç»„ä»¶ç»„ç»‡
```bash
# æŸ¥çœ‹ç»„ä»¶ç»“æ„
tree components -L 2 -I node_modules
```

#### lib/ ç›®å½•
- **auth.ts** - NextAuth é…ç½®
- **db.ts** - Prisma Client å®ä¾‹
- **utils.ts** - é€šç”¨å·¥å…·å‡½æ•°

**å®è·µ**ï¼šæŸ¥çœ‹æ ¸å¿ƒé…ç½®æ–‡ä»¶
```bash
# æŸ¥çœ‹å…³é”®æ–‡ä»¶
cat lib/auth.ts
cat lib/db.ts
```

---

## 2. æŠ€æœ¯æ ˆæ¢³ç†

### ğŸ› ï¸ æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Next.js | 14.2.3 | å…¨æ ˆæ¡†æ¶ |
| React | 18.3.1 | UI æ¡†æ¶ |
| TypeScript | 5.4.5 | ç±»å‹ç³»ç»Ÿ |
| Prisma | 5.15.0 | ORM |
| NextAuth.js | 5.0.0-beta.15 | è®¤è¯ |
| Tailwind CSS | 3.4.3 | æ ·å¼ |
| shadcn/ui | - | UI ç»„ä»¶åº“ |

### ğŸ“¦ å…³é”®ä¾èµ–

- **@tanstack/react-query** - æ•°æ®è·å–å’Œç¼“å­˜
- **sonner** - Toast é€šçŸ¥
- **vis-network** - çŸ¥è¯†å›¾è°±å¯è§†åŒ–
- **react-markdown** - Markdown æ¸²æŸ“
- **@tiptap/react** - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

**å®è·µ**ï¼šæŸ¥çœ‹ package.json
```bash
cat package.json | grep -A 50 "dependencies"
```

---

## 3. è®¤è¯ç³»ç»Ÿæ¶æ„

### ğŸ” è®¤è¯æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ç™»å½•
    â†“
NextAuth.js å¤„ç†
    â†“
OAuth æä¾›å•†ï¼ˆGitHub/Googleï¼‰
    â†“
å›è°ƒåˆ° /api/auth/callback/[provider]
    â†“
åˆ›å»º/æ›´æ–°ç”¨æˆ· Session
    â†“
é‡å®šå‘åˆ°ç›®æ ‡é¡µé¢
```

### ğŸ“ å…³é”®æ–‡ä»¶

- `lib/auth.ts` - NextAuth é…ç½®
- `middleware.ts` - è·¯ç”±ä¿æŠ¤
- `app/(auth)/login/page.tsx` - ç™»å½•é¡µé¢
- `app/api/auth/[...nextauth]/route.ts` - è®¤è¯ API è·¯ç”±

**å®è·µ**ï¼šè¿½è¸ªè®¤è¯æµç¨‹
1. æŸ¥çœ‹ `lib/auth.ts` çš„é…ç½®
2. æŸ¥çœ‹ `middleware.ts` çš„ä¿æŠ¤è§„åˆ™
3. æµ‹è¯•ç™»å½•æµç¨‹

### ğŸ” ä»£ç è¿½è¸ª

```typescript
// 1. è®¤è¯é…ç½®
// lib/auth.ts
export const { auth, signIn, signOut } = NextAuth({...})

// 2. è·¯ç”±ä¿æŠ¤
// middleware.ts
export default auth((req) => {
  if (!req.auth) {
    return NextResponse.redirect('/login')
  }
})

// 3. æœåŠ¡ç«¯è·å–ç”¨æˆ·
// lib/auth-server.ts
export async function getCurrentUser() {
  const session = await auth()
  return session?.user
}
```

---

## 4. æ•°æ®å±‚æ¶æ„

### ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

**æ ¸å¿ƒæ¨¡å‹**ï¼š
- `User` - ç”¨æˆ·
- `Note` - ç¬”è®°
- `Post` - æ–‡ç« 
- `Category` - åˆ†ç±»
- `Tag` - æ ‡ç­¾
- `Link` - åŒå‘é“¾æ¥å…³ç³»

**å®è·µ**ï¼šæŸ¥çœ‹æ•°æ®åº“æ¨¡å‹
```bash
# æŸ¥çœ‹ Schema
cat prisma/schema.prisma
```

### ğŸ“Š æ•°æ®æµ

```
UI ç»„ä»¶
    â†“
Server Action (app/actions/)
    â†“
Prisma Client (lib/db.ts)
    â†“
PostgreSQL æ•°æ®åº“
```

### ğŸ” ä»£ç è¿½è¸ª

```typescript
// 1. Server Action
// app/actions/notes.ts
export async function createNote(data: CreateNoteInput) {
  const user = await getCurrentUser()
  return await db.note.create({
    data: { ...data, userId: user.id }
  })
}

// 2. Prisma Client
// lib/db.ts
export const db = new PrismaClient()

// 3. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
// app/(dashboard)/notes/page.tsx
const notes = await db.note.findMany({
  where: { userId: user.id }
})
```

**å®è·µ**ï¼šè¿½è¸ªä¸€ä¸ªå®Œæ•´çš„ CRUD æ“ä½œ
1. æŸ¥çœ‹åˆ›å»ºç¬”è®°çš„ Server Action
2. æŸ¥çœ‹ç¬”è®°åˆ—è¡¨é¡µé¢çš„æ•°æ®è·å–
3. ç†è§£æ•°æ®å¦‚ä½•ä»æ•°æ®åº“åˆ° UI

---

## 5. è·¯ç”±ç³»ç»Ÿè®¾è®¡

### ğŸ—ºï¸ è·¯ç”±ç»“æ„

```
/                          # é¦–é¡µ
â”œâ”€â”€ /login                 # ç™»å½•é¡µ
â”œâ”€â”€ /blog                  # åšå®¢é¦–é¡µ
â”‚   â””â”€â”€ /blog/[slug]       # æ–‡ç« è¯¦æƒ…
â”œâ”€â”€ /interview             # é¢è¯•é¢˜åº“
â”‚   â””â”€â”€ /interview/[...path] # é¢è¯•é¢˜è¯¦æƒ…
â””â”€â”€ /dashboard             # ä»ªè¡¨æ¿ï¼ˆéœ€ç™»å½•ï¼‰
    â”œâ”€â”€ /notes             # ç¬”è®°åˆ—è¡¨
    â”œâ”€â”€ /notes/[id]        # ç¬”è®°è¯¦æƒ…
    â”œâ”€â”€ /notes/[id]/edit   # ç¼–è¾‘ç¬”è®°
    â”œâ”€â”€ /search            # æœç´¢
    â”œâ”€â”€ /categories        # åˆ†ç±»ç®¡ç†
    â”œâ”€â”€ /tags              # æ ‡ç­¾ç®¡ç†
    â”œâ”€â”€ /graph             # çŸ¥è¯†å›¾è°±
    â””â”€â”€ /moc               # MOC åˆ—è¡¨
```

### ğŸ¯ è·¯ç”±ç»„çš„ä½œç”¨

- `(auth)` - è®¤è¯ç›¸å…³è·¯ç”±
- `(blog)` - åšå®¢ç›¸å…³è·¯ç”±ï¼ˆå…¬å¼€ï¼‰
- `(dashboard)` - ä»ªè¡¨æ¿è·¯ç”±ï¼ˆéœ€ç™»å½•ï¼‰

**å®è·µ**ï¼šç†è§£è·¯ç”±ç»„
```bash
# æŸ¥çœ‹è·¯ç”±ç»„
ls -la app/ | grep "("
```

### ğŸ”’ è·¯ç”±ä¿æŠ¤

```typescript
// middleware.ts
export const config = {
  matcher: [
    "/dashboard/:path*",
    "/notes/:path*",
  ],
}
```

---

## 6. çŠ¶æ€ç®¡ç†ç­–ç•¥

### ğŸ“Š çŠ¶æ€ç®¡ç†æ–¹å¼

#### 6.1 Server State
- **æ•°æ®è·å–**ï¼šServer Components ç›´æ¥è·å–
- **æ•°æ®ä¿®æ”¹**ï¼šServer Actions
- **ç¼“å­˜**ï¼šNext.js è‡ªåŠ¨ç¼“å­˜

```typescript
// Server Component è·å–æ•°æ®
export default async function NotesPage() {
  const notes = await db.note.findMany()
  return <NoteList notes={notes} />
}
```

#### 6.2 Client State
- **è¡¨å•çŠ¶æ€**ï¼šReact useState
- **UI çŠ¶æ€**ï¼šReact useState
- **å…¨å±€çŠ¶æ€**ï¼šContext APIï¼ˆå¦‚é¢è¯•é¢˜åº“çš„å±•å¼€çŠ¶æ€ï¼‰

```typescript
// Client Component ç®¡ç†çŠ¶æ€
"use client"
export function NoteEditor() {
  const [title, setTitle] = useState("")
  const [isPending, startTransition] = useTransition()
  // ...
}
```

#### 6.3 æœåŠ¡ç«¯çŠ¶æ€ï¼ˆReact Queryï¼‰
- **æ•°æ®ç¼“å­˜**ï¼š@tanstack/react-query
- **è‡ªåŠ¨é‡æ–°è·å–**ï¼šé…ç½®çš„ refetch ç­–ç•¥

---

## ğŸ¯ æ¶æ„å›¾

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç”¨æˆ·æµè§ˆå™¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Next.js App Router                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Server     â”‚  â”‚   Client     â”‚    â”‚
â”‚  â”‚  Components  â”‚  â”‚  Components  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                 â”‚             â”‚
â”‚         â–¼                 â–¼             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Server     â”‚  â”‚   React      â”‚   â”‚
â”‚  â”‚   Actions    â”‚  â”‚   Hooks      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Prisma Client                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PostgreSQL æ•°æ®åº“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… é˜¶æ®µ 1-2 å®Œæˆæ£€æŸ¥

- [ ] èƒ½è§£é‡Šé¡¹ç›®çš„ç›®å½•ç»“æ„
- [ ] ç†è§£è®¤è¯ç³»ç»Ÿçš„æµç¨‹
- [ ] èƒ½è¿½è¸ªæ•°æ®ä» UI åˆ°æ•°æ®åº“çš„å®Œæ•´æµç¨‹
- [ ] ç†è§£è·¯ç”±ç³»ç»Ÿçš„è®¾è®¡
- [ ] çŸ¥é“ä½•æ—¶ä½¿ç”¨ Server State å’Œ Client State

## ğŸ“ å®è·µä»»åŠ¡

1. **ç»˜åˆ¶æ¶æ„å›¾**ï¼šç”¨å·¥å…·ï¼ˆå¦‚ draw.ioï¼‰ç»˜åˆ¶é¡¹ç›®çš„æ•´ä½“æ¶æ„å›¾
2. **è¿½è¸ªæ•°æ®æµ**ï¼šé€‰æ‹©ä¸€ä¸ªåŠŸèƒ½ï¼ˆå¦‚åˆ›å»ºç¬”è®°ï¼‰ï¼Œè¿½è¸ªå®Œæ•´çš„æ•°æ®æµ
3. **åˆ†æè·¯ç”±ç»“æ„**ï¼šç†è§£æ¯ä¸ªè·¯ç”±ç»„çš„ä½œç”¨å’Œå¸ƒå±€åµŒå¥—

## â¡ï¸ ä¸‹ä¸€æ­¥

å®Œæˆé˜¶æ®µ 1-2 åï¼Œç»§ç»­å­¦ä¹ ï¼š
ğŸ‘‰ [02-åŠŸèƒ½æ¨¡å—å­¦ä¹ .md](./02-åŠŸèƒ½æ¨¡å—å­¦ä¹ .md)

